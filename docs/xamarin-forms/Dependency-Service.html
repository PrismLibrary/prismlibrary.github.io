<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Using the DependencyService with Prism | Prism </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Using the DependencyService with Prism | Prism ">
    <meta name="generator" content="docfx 2.42.3.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <link rel="stylesheet" href="../../styles/affix.css">
    <meta property="docfx:navrel" content="../../toc">
    <meta property="docfx:tocrel" content="../toc">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../images/prism-logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
                <ul class="nav level1 navbar-nav">
                  <li class="">
                    <a href="http://prismlibrary.github.io/" title="Home" class="">Home</a>
                  </li>
                  <li class="active">
                    <a href="../../docs/index.html" title="Documentation" class="active">Documentation</a>
                  </li>
                  <li class="">
                    <a href="https://www.pluralsight.com/authors/brian-lagunas/" title="Learn" class="">Learn</a>
                  </li>
                </ul>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div>
              <div class="sidefilter">
                <form class="toc-filter">
                  <span class="glyphicon glyphicon-filter filter-icon"></span>
                  <input type="text" id="toc_filter_input" placeholder="Enter here to filter..." onkeypress="if(event.keyCode==13) {return false;}">
                </form>
              </div>
              <div class="sidetoc">
                <div class="toc" id="toc">
                  
                  <ul class="nav level1">
                    <li class="">
                      <a href="../index.html" title="Introduction" class="">Introduction</a>
                    </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Getting Started</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../getting-started/Download-and-Setup-Prism.html" title="Download and Setup Prism" class="">Download and Setup Prism</a>
                          </li>
                          <li class="">
                            <a href="../getting-started/NuGet-Packages.html" title="NuGet Packages" class="">NuGet Packages</a>
                          </li>
                          <li class="">
                            <a href="../getting-started/productivity-tools.html" title="Productivity Tools" class="">Productivity Tools</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <a href="../commanding.html" title="Commanding" class="">Commanding</a>
                    </li>
                    <li class="">
                      <a href="../composite-commands.html" title="Composite Commands" class="">Composite Commands</a>
                    </li>
                    <li class="">
                      <a href="../event-aggregator.html" title="Event Aggregator" class="">Event Aggregator</a>
                    </li>
                    <li class="">
                      <a href="../viewmodel-locator.html" title="ViewModelLocator" class="">ViewModelLocator</a>
                    </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">WPF</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <span class="expand-stub"></span>
                            <a class="">Legacy (Prism 6)</a>
                              
                              <ul class="nav level3">
                                <li class="">
                                  <a href="../wpf/legacy/Introduction.html" title="Introduction" class="">Introduction</a>
                                </li>
                                <li class="">
                                  <a href="../wpf/legacy/Initializing.html" title="Initializing" class="">Initializing</a>
                                </li>
                                <li class="">
                                  <a href="../wpf/legacy/Managing-Dependencies.html" title="Managing-Dependencies" class="">Managing-Dependencies</a>
                                </li>
                                <li class="">
                                  <a href="../wpf/legacy/Modules.html" title="Modules" class="">Modules</a>
                                </li>
                                <li class="">
                                  <a href="../wpf/legacy/Implementing-MVVM.html" title="Implementing-MVVM" class="">Implementing-MVVM</a>
                                </li>
                                <li class="">
                                  <a href="../wpf/legacy/Advanced-MVVM.html" title="Advanced-MVVM" class="">Advanced-MVVM</a>
                                </li>
                                <li class="">
                                  <a href="../wpf/legacy/Composing-the-UI.html" title="Composing-the-UI" class="">Composing-the-UI</a>
                                </li>
                                <li class="">
                                  <a href="../wpf/legacy/Navigation.html" title="Navigation" class="">Navigation</a>
                                </li>
                                <li class="">
                                  <a href="../wpf/legacy/Communication.html" title="Communication" class="">Communication</a>
                                </li>
                                <li class="">
                                  <a href="../wpf/legacy/Deploying.html" title="Deploying" class="">Deploying</a>
                                </li>
                                <li class="">
                                  <a href="../wpf/legacy/Appendix-A-Glossary.html" title="Appendix-A-Glossary" class="">Appendix-A-Glossary</a>
                                </li>
                                <li class="">
                                  <a href="../wpf/legacy/Appendix-B-Patterns.html" title="Appendix-B-Patterns" class="">Appendix-B-Patterns</a>
                                </li>
                                <li class="">
                                  <a href="../wpf/legacy/Appendix-C-Prism-Library.html" title="Appendix-C-Prism-Library" class="">Appendix-C-Prism-Library</a>
                                </li>
                                <li class="">
                                  <a href="../wpf/legacy/Appendix-D-Extending-Prism.html" title="Appendix-D-Extending-Prism" class="">Appendix-D-Extending-Prism</a>
                                </li>
                                <li class="">
                                  <a href="../wpf/legacy/Appendix-E-Click-Once.html" title="Appendix-E-Click-Once" class="">Appendix-E-Click-Once</a>
                                </li>
                              </ul>  </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Xamarin.Forms</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../xamarin-forms/creating-your-first-prism-app.html" title="Create Your First App" class="">Create Your First App</a>
                          </li>
                          <li class="">
                            <span class="expand-stub"></span>
                            <a class="">Navigation</a>
                              
                              <ul class="nav level3">
                                <li class="">
                                  <a href="../xamarin-forms/navigation/navigation-basics.html" title="Navigation Basics" class="">Navigation Basics</a>
                                </li>
                                <li class="">
                                  <a href="../xamarin-forms/navigation/passing-parameters.html" title="Passing Parameters" class="">Passing Parameters</a>
                                </li>
                                <li class="">
                                  <a href="../xamarin-forms/navigation/confirming-navigation.html" title="Confirming Navigation" class="">Confirming Navigation</a>
                                </li>
                                <li class="">
                                  <a href="../xamarin-forms/navigation/deep-linking.html" title="Deep Linking" class="">Deep Linking</a>
                                </li>
                                <li class="">
                                  <a href="../xamarin-forms/navigation/working-with-masterdetailpages.html" title="Working w/ MasterDetailPages" class="">Working w/ MasterDetailPages</a>
                                </li>
                                <li class="">
                                  <a href="../xamarin-forms/navigation/working-with-navigationpages.html" title="Working w/ NavigationPages" class="">Working w/ NavigationPages</a>
                                </li>
                                <li class="">
                                  <a href="../xamarin-forms/navigation/working-with-tabbedpages.html" title="Working w/ TabbedPages" class="">Working w/ TabbedPages</a>
                                </li>
                                <li class="">
                                  <a href="../xamarin-forms/navigation/xaml-navigation.html" title="XAML Navigation" class="">XAML Navigation</a>
                                </li>
                              </ul>  </li>
                          <li class="">
                            <a href="../xamarin-forms/application-lifecycle.html" title="Application Lifecycle" class="">Application Lifecycle</a>
                          </li>
                          <li class="">
                            <a href="../xamarin-forms/page-lifecycle.html" title="Page Lifecycle" class="">Page Lifecycle</a>
                          </li>
                          <li class="">
                            <a href="../xamarin-forms/Page-Dialog-Service.html" title="Page Dialog Service" class="">Page Dialog Service</a>
                          </li>
                          <li class="">
                            <a href="../xamarin-forms/EventToCommandBehavior.html" title="EventToCommandBehavior" class="">EventToCommandBehavior</a>
                          </li>
                        </ul>  </li>
                  </ul>        </div>
              </div>
            </div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="using-the-dependencyservice-with-prism">Using the DependencyService with Prism</h1>

<p>Xamarin.Forms includes a DependencyService to let shared code to easily resolve Interfaces to platform-specific implementations, allowing you to access features of the iOS, Android and Windows Phone SDKs from your PCL or Shared Project.</p>
<p>The <strong>problem</strong> with Xamarin&#39;s DependencyService is that it requires a static call to DependencyService.Get&lt;&gt; in your shared code to get a platform-specific instance of the interface at run time.  This makes your ViewModels less testable, and hides the dependencies of your class.</p>
<p>Prism <strong>simplifies</strong> this feature by allowing you to simply request any dependencies that have been registered with Xamarin&#39;s DependencyService via your class constructor.</p>
<pre><code class="lang-cs">public MainPageViewModel(ITextToSpeech textToSpeechService)
{
    textToSpeechService.Speak(&quot;Hello World&quot;);
}
</code></pre><p>You can also gain access to Xamarin&#39;s DependencyService by using the <strong>IDependencyService</strong> interface.  This interface removes the static call in your ViewModel, but still gives you access to Xamarin&#39;s DependencyService API.</p>
<pre><code class="lang-cs">public MainPageViewModel(IDependencyService dependencyService)
{
    dependencyService.Get&lt;ITextToSpeech&gt;().Speak(&quot;Hello World&quot;);
}
</code></pre><h2 id="example">Example</h2>
<h3 id="step-1-create-project">Step 1: Create Project</h3>
<p>Create a new Xamarin.Forms Portable or Shared project.</p>
<h3 id="step-2-add-prism">Step 2: Add Prism</h3>
<p>Use NuGet to add Prism to each of your projects in the solution.</p>
<p>Add the Following Nuget packages to your projects.</p>
<ul>
<li><a href="https://www.nuget.org/packages/Prism.Unity.Forms/">Prism.Unity.Forms</a></li>
<li><a href="https://www.nuget.org/packages/Prism.Forms/">Prism.Forms</a></li>
<li><a href="https://www.nuget.org/packages/Prism.Core/">Prism.Core</a></li>
</ul>
<p><em>Hint: If you add the <strong>Prism.Unity.Forms</strong> NuGet package first, it will bring in the other Prism packages automatically.</em></p>
<h3 id="step-3-add-a-service">Step 3: Add a Service</h3>
<p>In this examples, we will leverage the speech API of each platform to provide text to speech capabilities to our application.  This means we need to create a service for each platform that will invoke that specific platform&#39;s speech API.</p>
<p>This will require two steps:</p>
<ul>
<li>Add an interface to the Portable project that will define the contract for our speech service:</li>
</ul>
<pre><code class="lang-cs">public interface ITextToSpeech
{
    void Speak(string text);
}
</code></pre><ul>
<li>Add a class that implements our interface to each specific platform.</li>
</ul>
<h4 id="windows-phone">Windows Phone</h4>
<pre><code class="lang-cs">public class TextToSpeech_WinPhone : ITextToSpeech
{
    public async void Speak(string text)
    {
        SpeechSynthesizer synth = new SpeechSynthesizer();
        await synth.SpeakTextAsync(text);
    }
}
</code></pre><h4 id="android">Android</h4>
<pre><code class="lang-cs">public class TextToSpeech_Android : Object, ITextToSpeech, TextToSpeech.IOnInitListener
{
    private TextToSpeech speaker;
    private string toSpeak;

    public void Speak(string text)
    {
        var c = Forms.Context;
        toSpeak = text;
        if (speaker == null)
        {
            speaker = new TextToSpeech(c, this);
        }
        else
        {
            var p = new Dictionary&lt;string, string&gt;();
            speaker.Speak(toSpeak, QueueMode.Flush, p);
            Debug.WriteLine(&quot;spoke &quot; + toSpeak);
        }
    }

    #region IOnInitListener implementation

    public void OnInit(OperationResult status)
    {
        if (status.Equals(OperationResult.Success))
        {
            Debug.WriteLine(&quot;speaker init&quot;);
            var p = new Dictionary&lt;string, string&gt;();
            speaker.Speak(toSpeak, QueueMode.Flush, p);
        }
        else
        {
            Debug.WriteLine(&quot;was quiet&quot;);
        }
    }

    #endregion
}
</code></pre><h4 id="ios">iOS</h4>
<pre><code class="lang-cs">public class TextToSpeech_iOS : ITextToSpeech
{
    public void Speak(string text)
    {
        var speechSynthesizer = new AVSpeechSynthesizer();

        var speechUtterance = new AVSpeechUtterance(text)
        {
            Rate = AVSpeechUtterance.MaximumSpeechRate / 4,
            Voice = AVSpeechSynthesisVoice.FromLanguage(&quot;en-US&quot;),
            Volume = 0.5f,
            PitchMultiplier = 1.0f
        };

        speechSynthesizer.SpeakUtterance(speechUtterance);
    }
}
</code></pre><p><strong>Note:</strong> To Enable the speech capabilities on Windows Phone, tick the <strong>ID_CAP_SPEECH_RECOGNITION</strong> capability in the WMAppManifest.xml, otherwise access to the speech APIs are blocked.</p>
<p><img src="images/dependencyservice_01.png" alt="WMAppManifest setting for speech"></p>
<h3 id="step-4-attribute-the-dependencyservice">Step 4: Attribute the DependencyService</h3>
<p>Now, add the DependencyService attribute to each of the services classes in the respective platforms.  This registers the platform specific implementation of the speech service with Xamarin.Forms&#39; DependencyService.</p>
<h4 id="windows-phone-dependencyservice">Windows Phone DependencyService</h4>
<pre><code class="lang-cs">[assembly: Dependency(typeof(TextToSpeech_WinPhone))]
</code></pre><h4 id="android-dependencyservice">Android DependencyService</h4>
<pre><code class="lang-cs">[assembly: Dependency(typeof(TextToSpeech_Android))]
</code></pre><h4 id="ios-dependencyservice">iOS DependencyService</h4>
<pre><code class="lang-cs">[assembly: Dependency(typeof(TextToSpeech_iOS))]
</code></pre><h3 id="step-5-use-the-speech-service">Step 5: Use the Speech Service</h3>
<h4 id="create-the-view">Create the View</h4>
<p>Create a view that we can use to pass text to the speech service for the device to read back.  This means we will need one Entry element to accept the text to speak, and one Button element to invoke a command in a ViewModel that will execute the speaking process from our speech service.</p>
<pre><code class="lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;ContentPage xmlns=&quot;http://xamarin.com/schemas/2014/forms&quot;
             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;
             xmlns:mvvm=&quot;clr-namespace:Prism.Mvvm;assembly=Prism.Forms&quot;
             mvvm:ViewModelLocator.AutowireViewModel=&quot;True&quot;
             x:Class=&quot;UsingDependencyService.Views.MainPage&quot;&gt;
  &lt;StackLayout VerticalOptions=&quot;CenterAndExpand&quot; HorizontalOptions=&quot;CenterAndExpand&quot;&gt;
    &lt;Entry Text=&quot;{Binding TextToSay}&quot; VerticalOptions=&quot;Center&quot; HorizontalOptions=&quot;Center&quot; /&gt;
    &lt;Button Command=&quot;{Binding SpeakCommand}&quot; Text=&quot;Speak&quot;/&gt;
  &lt;/StackLayout&gt;
&lt;/ContentPage&gt;
</code></pre><h4 id="create-the-viewmodel">Create the ViewModel</h4>
<p>Create a ViewModel that has two properties that our View will bind to.  We need a property to represent the text that we want to be spoken, and a command that the button in the View will invoke.</p>
<pre><code class="lang-cs">public class MainPageViewModel : BindableBase
{
    private string _textToSay = &quot;Hello from Xamarin.Forms and Prism&quot;;
    public string TextToSay
    {
        get { return _textToSay; }
        set { SetProperty(ref _textToSay, value); }
    }

    public DelegateCommand SpeakCommand { get; set; }

    public MainPageViewModel()
    {
        SpeakCommand = new DelegateCommand(Speak);
    }

    private void Speak()
    {
        //TODO: call service
    }
}
</code></pre><h4 id="use-the-service">Use the Service</h4>
<p>Normally to use Xamarin.Forms DependencyService, you have to make a static method call in your ViewModel like this:</p>
<pre><code class="lang-cs">private void Speak()
{
    DependencyService.Get&lt;ITextToSpeech&gt;().Speak(TextToSay);
}
</code></pre><p>This is <strong>not</strong> good.  You always want to avoid making calls to static methods in your ViewModela for a number of reasons. So how do we fix this?  Easy!  Let Prism do it for you.</p>
<p>When you attribute a class with the Xamarin.Forms DependencyService attribute, Prism automatically registers that class with the container.  This means you can now request the service via the ViewModel constructor as you do with your other dependencies.</p>
<p>Modify the ViewModel to accept the service through the constructor.  You will need to store this service instance in a variable so that it can be access in the Speak method.</p>
<pre><code class="lang-cs">public class MainPageViewModel : BindableBase
{
    private readonly ITextToSpeech _textToSpeech;

    private string _textToSay = &quot;Hello from Xamarin.Forms and Prism&quot;;
    public string TextToSay
    {
        get { return _textToSay; }
        set { SetProperty(ref _textToSay, value); }
    }

    public DelegateCommand SpeakCommand { get; set; }

    public MainPageViewModel(ITextToSpeech textToSpeech)
    {
        _textToSpeech = textToSpeech;
        SpeakCommand = new DelegateCommand(Speak);
    }

    private void Speak()
    {
        _textToSpeech.Speak(TextToSay);
    }
}
</code></pre><p>As you can see, you no longer need to make a call to the static Xamarin.Forms.DependencyService.  Just ask for it in your ViewModel constructor, and Prism will use the container to resolve the instance and provide it to you.</p>
<p><a href="https://github.com/PrismLibrary/Prism-Samples-Forms/tree/master/UsingDependencyService">View the Sample</a></p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix" style="margin-top: 0px;">
              <div class="connect-widget">
                <ul class="connect-links">
          		<li id="connect-github">
          			<a href="https://github.com/PrismLibrary/Prism-Documentation/blob/master/docs/xamarin-forms/Dependency-Service.md/#L1" target="_blank">
          				<div class="image github"></div>Edit on GitHub
          			</a>
                  </li>
                  <li id="connect-stack-overflow">
                      <a href="https://stackoverflow.com/questions/tagged/prism" target="_blank">
                          <div class="image stackoverflow"></div>Ask questions
                      </a>
                  </li>
                  <li id="connect-twitter">
                      <a href="https://twitter.com/prismlib" target="_blank">
                          <div class="image twitterhandle"></div>Follow @PrismLib
                      </a>
                  </li>
                  <li id="connect-twitter">
                      <a href="https://twitter.com/brianlagunas" target="_blank">
                          <div class="image twitterhandle"></div>Follow @BrianLagunas
                      </a>
                  </li>
                  <li id="connect-twitter">
                      <a href="https://twitter.com/danjsiegel" target="_blank">
                          <div class="image twitterhandle"></div>Follow @DanJSiegel
                      </a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            Copyright 2017 Prism
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
